# Cursor MCP Workspace Variable Solution

## The Problem

MCP (Model Context Protocol) servers don't automatically know which workspace they're operating in. This causes issues for workspace-aware servers like:
- **Timepon** - needs to know which folder to track
- **fckgit** - needs to know which repo to manage
- **Any file-system based MCP server**

Traditional solutions use hardcoded paths, which break across multiple workspaces.

## The Solution: `${workspaceFolder}`

Cursor (and VS Code) support **variable substitution** in MCP configuration files. The most important variable:

```
${workspaceFolder}
```

This automatically resolves to the absolute path of your current workspace root.

## How It Works

### Global Config (Don't Use for Workspace-Specific Servers)
**File:** `~/.cursor/mcp.json` or `C:\Users\YourName\.cursor\mcp.json`

This applies to ALL workspaces. Only use for workspace-agnostic servers like:
- GitHub MCP
- Tavily search
- External API services

### Local Config (Use This!)
**File:** `.cursor/mcp.json` in your workspace root

This overrides the global config for THAT workspace only. Perfect for workspace-specific servers.

## Implementation

### Step 1: Create Local Config

In your workspace root, create `.cursor/mcp.json`:

```json
{
  "mcpServers": {
    "timepon": {
      "command": "node",
      "args": ["C:\\path\\to\\mcp-server\\index.js"],
      "env": {
        "TIMEPON_WORKSPACE": "${workspaceFolder}"
      }
    }
  }
}
```

### Step 2: Variable Resolution

When Cursor loads this workspace, it automatically replaces `${workspaceFolder}` with the actual path:

**Before (what you write):**
```json
"TIMEPON_WORKSPACE": "${workspaceFolder}"
```

**After (what the server receives):**
```
TIMEPON_WORKSPACE=C:\Users\Fab2\Desktop\AI\MyProject
```

### Step 3: Server Reads Variable

Your MCP server reads the environment variable:

```javascript
const workspaceRoot = process.env.TIMEPON_WORKSPACE;
// workspaceRoot = "C:\Users\Fab2\Desktop\AI\MyProject"
```

## Available Variables

Cursor supports these variables in MCP configs:

| Variable | Description | Example |
|----------|-------------|---------|
| `${workspaceFolder}` | Full absolute path to workspace root | `C:\Users\Fab2\Desktop\AI\MyProject` |
| `${workspaceFolderBasename}` | Workspace folder name only | `MyProject` |
| `${env:VARIABLE_NAME}` | Reference system environment variables | `${env:HOME}` → `C:\Users\Fab2` |
| `${userHome}` | User's home directory | `C:\Users\Fab2` |

## Complete Example

### Workspace Structure
```
MyProject/
├── .cursor/
│   └── mcp.json          ← Local config (workspace-specific)
├── src/
├── _timepon.yaml         ← Generated by Timepon for this workspace
└── README.md
```

### .cursor/mcp.json
```json
{
  "mcpServers": {
    "timepon": {
      "command": "node",
      "args": [
        "C:\\Users\\Fab2\\Desktop\\AI\\_timecop\\mcp-server\\index.js"
      ],
      "env": {
        "TIMEPON_WORKSPACE": "${workspaceFolder}"
      }
    },
    "fckgit": {
      "command": "python",
      "args": ["-m", "mcp_server"],
      "cwd": "C:\\Users\\Fab2\\Desktop\\AI\\_tools\\_fckgit",
      "env": {
        "GEMINI_API_KEY": "your-api-key",
        "GIT_WORKSPACE": "${workspaceFolder}"
      }
    }
  }
}
```

## Multi-Workspace Setup

Each workspace gets its own independent configuration:

### Workspace A: `C:\Projects\WebApp\.cursor\mcp.json`
```json
{
  "mcpServers": {
    "timepon": {
      "command": "node",
      "args": ["C:\\Tools\\timepon\\mcp-server\\index.js"],
      "env": {
        "TIMEPON_WORKSPACE": "${workspaceFolder}"
      }
    }
  }
}
```
→ Resolves to: `TIMEPON_WORKSPACE=C:\Projects\WebApp`

### Workspace B: `C:\Projects\API\.cursor\mcp.json`
```json
{
  "mcpServers": {
    "timepon": {
      "command": "node",
      "args": ["C:\\Tools\\timepon\\mcp-server\\index.js"],
      "env": {
        "TIMEPON_WORKSPACE": "${workspaceFolder}"
      }
    }
  }
}
```
→ Resolves to: `TIMEPON_WORKSPACE=C:\Projects\API`

**Same config file, different workspaces, automatic path resolution!**

## Advantages Over Hardcoded Paths

### ❌ Old Way (Hardcoded)
```json
{
  "env": {
    "TIMEPON_WORKSPACE": "C:\\Users\\Fab2\\Desktop\\AI\\MyProject"
  }
}
```

**Problems:**
- Breaks when project moves
- Different on every machine
- Different for every team member
- Must manually edit for each workspace

### ✅ New Way (Variable)
```json
{
  "env": {
    "TIMEPON_WORKSPACE": "${workspaceFolder}"
  }
}
```

**Benefits:**
- Works anywhere the workspace is located
- Same config across all machines
- Team members can share the config
- Copy-paste to new workspaces
- No manual path editing needed

## Automated Installation

For Timepon, we provide an installer that creates the config automatically:

```powershell
cd C:\path\to\your\workspace
powershell -ExecutionPolicy Bypass -File C:\path\to\timepon\mcp-server\install-to-workspace.ps1
```

This creates `.cursor/mcp.json` with `${workspaceFolder}` already configured.

## Troubleshooting

### Variable Not Resolving
**Symptom:** Server receives literal string `"${workspaceFolder}"`

**Causes:**
1. Using global config instead of local (variables only work in workspace configs)
2. Config file in wrong location (must be in `.cursor/mcp.json` at workspace root)
3. Cursor version too old (update to latest)

**Fix:** Create `.cursor/mcp.json` in your workspace root, not globally.

### Server Not Finding Workspace
**Symptom:** Server can't find files, wrong directory

**Debug:**
1. Check the environment variable in your server:
   ```javascript
   console.error('Workspace:', process.env.TIMEPON_WORKSPACE);
   ```
2. Verify it matches your workspace path
3. Check Cursor opened the correct folder as workspace

### Multiple Workspaces Conflict
**Symptom:** Server tracking wrong workspace

**Cause:** Using global config with hardcoded path

**Fix:** Remove workspace-specific servers from global config, use local configs only.

## Best Practices

### DO ✅
- Use `.cursor/mcp.json` for workspace-specific servers
- Use `${workspaceFolder}` for automatic path resolution
- Keep global config for workspace-agnostic services only
- Share `.cursor/mcp.json` with your team (commit to git)

### DON'T ❌
- Don't use hardcoded absolute paths
- Don't put workspace-specific servers in global config
- Don't manually edit paths for each workspace
- Don't forget to restart Cursor after config changes

## Configuration Override Priority

1. **Local workspace config** (`.cursor/mcp.json` in workspace) - HIGHEST PRIORITY
2. **Global user config** (`~/.cursor/mcp.json`) - Fallback
3. **Default Cursor settings** - Last resort

Local configs completely override global for that workspace.

## Testing Your Setup

1. Create `.cursor/mcp.json` in workspace
2. Restart Cursor
3. Check server logs in Cursor's Tools & MCP settings
4. Verify the resolved path in server output
5. Test with multiple workspaces to confirm independence

## Real-World Example: Timepon

### Without Variables (Broken)
```json
{
  "mcpServers": {
    "timepon": {
      "command": "node",
      "args": ["C:\\timecop\\mcp-server\\index.js"],
      "env": {
        "TIMEPON_WORKSPACE": "C:\\Users\\Fab2\\Desktop\\AI\\Project1"
      }
    }
  }
}
```
- Only works for Project1
- Must edit for Project2, Project3, etc.
- Breaks when projects move
- Different on colleague's machine

### With Variables (Perfect)
```json
{
  "mcpServers": {
    "timepon": {
      "command": "node",
      "args": ["C:\\timecop\\mcp-server\\index.js"],
      "env": {
        "TIMEPON_WORKSPACE": "${workspaceFolder}"
      }
    }
  }
}
```
- Works for ANY workspace
- Copy to any project
- Same config for whole team
- Survives project moves
- Zero manual editing

## Additional Resources

- [Cursor MCP Documentation](https://docs.cursor.com/context/model-context-protocol)
- [VS Code Variables Reference](https://code.visualstudio.com/docs/editor/variables-reference)
- [Model Context Protocol Specification](https://modelcontextprotocol.io)

## Summary

The `${workspaceFolder}` variable is the **correct solution** for per-workspace MCP server configuration. It provides:

✅ Automatic workspace detection  
✅ Cross-machine compatibility  
✅ Team sharing friendly  
✅ Zero manual configuration  
✅ Multi-workspace independence  

Stop using hardcoded paths. Use `${workspaceFolder}` in `.cursor/mcp.json` for workspace-specific MCP servers.
